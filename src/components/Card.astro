---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { cn } from '@/utils/tailwind';
import type { HTMLTag } from 'astro/types';

type Props = {
  as?: HTMLTag;
  class?: string;
  href?: string;
  heading?: string;
  subheading?: string;
  date?: string;
  imagePath?: string;
  altText?: string;
  imageClass?: string;
};

const {
  as: Tag = 'div',
  class: className,
  href,
  heading,
  subheading,
  date,
  imagePath,
  altText = '',
  imageClass,
} = Astro.props as Props;

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/*.{jpeg,jpg,png,gif}'
);

const normalizedImagePath =
  imagePath &&
  (imagePath.startsWith('/src/assets/')
    ? imagePath
    : `/src/assets/${imagePath}`);

const imageLoader = normalizedImagePath
  ? images[normalizedImagePath]
  : undefined;

if (normalizedImagePath && !imageLoader) {
  throw new Error(
    `"${normalizedImagePath}" does not exist in glob: "/src/assets/*.{jpeg,jpg,png,gif}"`
  );
}
---

<Tag
  class={cn(
    className,
    'relative rounded-2xl border border-border bg-primary-foreground px-5 py-3',
    href && 'transition-all hover:border-foreground/25 hover:shadow-sm fade'
  )}
  href={href}
  target={href ? '_blank' : undefined}
  rel={href ? 'noopener noreferrer' : undefined}
>
  {
    imageLoader && (
      <Image
        src={imageLoader()}
        alt={altText}
        class={cn('mb-3 md:absolute rounded-full md:mb-0', imageClass)}
        loading="eager"
      />
    )
  }

  <div class="flex flex-col gap-y-1.5">
    <div class="flex flex-col gap-y-0.5">
      {heading && <h1 class="text-lg font-medium">{heading}</h1>}
      {subheading && <h2 class="text-muted-foreground">{subheading}</h2>}
      {date && <h2 class="text-muted-foreground">{date}</h2>}
    </div>
    <slot />
  </div>
</Tag>
